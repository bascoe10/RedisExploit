import socket


class NaiveRedisClient:

    def __init__(self, host, port=6379):
        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.sock.connect((host, port))

    def __send_message(self, command, args=None):
        fmessage = "{0}\r\n".format(command)
        if(args):
            fmessage = "{0} {1}\r\n".format(command, args)
        print(fmessage)
        self.sock.send(fmessage.encode())

    def __receive_message(self):
        message = self.sock.recv(1024)
        print(message)
        return message

    # TODO: Manage quotes
    def set(self, key, value):
        self.__send_message(
            'SET',
            "{0} '{1}'".format(key, value)
        )
        return self.__receive_message()

    def flushall(self):
        self.__send_message(
            'FLUSHALL'
        )
        return self.__receive_message()

    def config_set(self, key, value):
        self.__send_message(
            'CONFIG SET',
            "{0} '{1}'".format(key, value)
        )
        return self.__receive_message()

    def save(self):
        self.__send_message(
            'SAVE'
        )
        return self.__receive_message()

    def close(self):
        self.sock.close()
